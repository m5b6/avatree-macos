# Minimum required version of CMake
cmake_minimum_required(VERSION 2.8)
#set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MT")
#set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /MTd")
set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MD")
set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /MDd")
#set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR})

function(enable_unity_build UB_SUFFIX SOURCE_VARIABLE_NAME)
  set(files ${${SOURCE_VARIABLE_NAME}})
  # Generate a unique filename for the unity build translation unit
  set(unit_build_file ${CMAKE_CURRENT_BINARY_DIR}/ub_${UB_SUFFIX}.cpp)
  # Exclude all translation units from compilation
  set_source_files_properties(${files} PROPERTIES HEADER_FILE_ONLY true)
  # Open the ub file
  FILE(WRITE ${unit_build_file} "// Unity Build generated by CMake\n")
  # Add include statement for each translation unit
  foreach(source_file ${files} )
    FILE( APPEND ${unit_build_file} "#include <${CMAKE_CURRENT_SOURCE_DIR}/${source_file}>\n")
  endforeach(source_file)
  # Complement list of translation units with the name of ub
  set(${SOURCE_VARIABLE_NAME} ${${SOURCE_VARIABLE_NAME}} ${unit_build_file} PARENT_SCOPE)  
endfunction(enable_unity_build)





set(TARGETLIB ModellerLib CACHE TYPE STRING)
project(${TARGETLIB})
file(GLOB MODELLER_SRC
    "*.cpp"
	"include/*.h"
	"../PoissonRecon/*.h"
    "../PoissonRecon/*.cpp"
	"../PoissonRecon/PoissonRecon/*.cpp"
)







if (UNIX)
	include_directories(${EIGEN3_INCLUDE_DIR})
	include_directories("/usr/local/include/CGAL/GMP")
	include_directories(${Boost_INCLUDE_DIRS}) 
	include_directories(${CMAKE_SOURCE_DIR}/include/OpenGL)
	include_directories(${CMAKE_SOURCE_DIR}/include)
	include_directories(${CMAKE_SOURCE_DIR}/src/Modeller/Modeller)
	include_directories(${CMAKE_SOURCE_DIR}/src/Modeller/Modeller/include)
	include_directories(${CMAKE_SOURCE_DIR}/src/Modeller/PoissonRecon)

	set(MODELLER_LIBRARIES /usr/lib/x86_64-linux-gnu/libmpfr.so /usr/lib/libgmp.so.10.3.2 /usr/lib/x86_64-linux-gnu/libboost_filesystem.so /usr/lib/x86_64-linux-gnu/libboost_system.so )
	
	add_library(${TARGETLIB} STATIC ${MODELLER_SRC})

	target_link_libraries(${TARGETLIB} ${MODELLER_LIBRARIES}  -lCGAL )
endif()




if (MSVC)
	include_directories(${EIGEN3_INCLUDE_DIR})
	include_directories(${Boost_INCLUDE_DIRS}) 
	include_directories(${CMAKE_SOURCE_DIR}/include/OpenGL)
	include_directories(${CMAKE_SOURCE_DIR}/include)
	include_directories(${CMAKE_SOURCE_DIR}/src/Modeller/Modeller)
	include_directories(${CMAKE_SOURCE_DIR}/src/Modeller/Modeller/include)
	include_directories(${CGAL_DIR}/auxiliary/gmp/include)
	include_directories(${CGAL_BUILD_DIR}/include)
	include_directories(${CGAL_DIR}/include)
	
	link_directories(${CGAL_BUILD_DIR}/lib)
	link_directories(${CGAL_BUILD_DIR}/lib/$(Configuration))
	link_directories(${Boost_LIBRARY_DIR})
	link_directories(${Boost_LIBRARY_DIR})
	link_directories(${CMAKE_BINARY_DIR})
	link_directories(${CMAKE_SOURCE_DIR}/lib)

	include_directories(${PCL_INCLUDE_DIRS})
	link_directories(${PCL_LIBRARY_DIRS})
	add_definitions(${PCL_DEFINITIONS})

	set(MODELLER_LIBRARIES  ${CGAL_DIR}/auxiliary/gmp/lib/libmpfr-4.lib ${CGAL_DIR}/auxiliary/gmp/lib/libgmp-10.lib) 
	



	add_library(${TARGETLIB} STATIC ${MODELLER_SRC})
	set_property(TARGET ${TARGETLIB}  PROPERTY FOLDER "Library")
	target_link_libraries(${TARGETLIB} ${MODELLER_LIBRARIES} )
	target_link_libraries(${TARGETLIB} ${PCL_COMMON_LIBRARIES} ${PCL_IO_LIBRARIES} ${PCL_VISUALIZATION_LIBRARIES} ${PCL_SURFACE_LIBRARIES} ${PCL_FILTERS_LIBRARIES} ${PCL_FEATURES_LIBRARIES})
	

if( ACTIVATE_CONCURRENCY )
  if( TBB_FOUND )
    include_directories(${TBB_INCLUDE_DIR})
    target_link_libraries(${TARGETLIB} ${TBB_LIBRARY_RELEASE} ${TBB_MALLOC_LIBRARY_RELEASE} ${TBB_PROXY_LIBRARY_RELEASE})
  endif()
endif()
	
endif()








#if (USE_BULLET)
#set(MODELLER_LIBRARIES  ${CMAKE_SOURCE_DIR}/lib/OpenGLSupport_vs2010.lib ${CMAKE_SOURCE_DIR}/lib/BulletSoftBody_vs2010.lib ${CMAKE_SOURCE_DIR}/lib/BulletDynamics_vs2010.lib ${CMAKE_SOURCE_DIR}/lib/BulletCollision_vs2010.lib ${CMAKE_SOURCE_DIR}/lib/LinearMath_vs2010.lib  ${CMAKE_SOURCE_DIR}/include/extras/lib/BulletFileLoader_vs2010.lib ${CMAKE_SOURCE_DIR}/lib/HACD_vs2010.lib ${CMAKE_SOURCE_DIR}/lib/ConvexDecomposition_vs2010.lib)
#endif()
#if (USE_BULLET)
#include_directories(${CMAKE_SOURCE_DIR}/include/extras/Serialize/BulletFileLoader)
#include_directories(${CMAKE_SOURCE_DIR}/include/extras/Serialize/BulletWorldImporter)
#include_directories(${CMAKE_SOURCE_DIR}/include/extras/HACD)
#include_directories(${CMAKE_SOURCE_DIR}/include/extras/ConvexDecomposition)
#endif()


